(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{616:function(e,s,t){"use strict";t.r(s);var a=t(890),i=t(713);for(var n in i)"default"!==n&&function(e){t.d(s,e,function(){return i[e]})}(n);t(845),t(846);var c=t(74),o=Object(c.a)(i.default,a.a,a.b,!1,null,null,null);o.options.__file="src/pages/wechat/chat.vue",s.default=o.exports},713:function(e,s,t){"use strict";t.r(s);var a=t(714),i=t.n(a);for(var n in a)"default"!==n&&function(e){t.d(s,e,function(){return a[e]})}(n);s.default=i.a},714:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a,i=t(624),n=t(639),c=t(844);(a=c)&&a.__esModule;s.default={name:"chat",data:function(){return{chatLoginName:"",searchName:"",chatDetail:{chatName:"",type:"",readay:""},chatLineList:[],chatList:[],message:"",localMessage:JSON.parse(localStorage.getItem("messageList"))||[],localIndex:"",messageList:[],sysMessages:[],chatTheme:"chat-bg-color-0",isShowSys:!1,animals:1,activePanel:"friend",isChatLogin:!1,errorMessage:"",isErrMes:!1,isUseEnterSend:!0}},methods:{initWebSocket:function(){var e=this;this.websock=new WebSocket("ws://127.0.0.1:3001"),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose,window.onunload=function(){e.close()},window.onbeforeunload=function(){this.close()}},websocketonopen:function(){if(console.log("WebSocket连接成功"),this.isChatLogin=!0,this.isErrMes=!1,this.chatLoginName){var e={type:"login",username:this.chatLoginName};this.websock.send(JSON.stringify(e))}},websocketonmessage:function(e){var s=this;console.log(e.data);var t=JSON.parse(e.data);if("system"===t.type&&this.sysMessages.push(t.message),"userList"===t.type&&(this.chatLineList=t.message),"message"===t.type){var a=this.chatLoginName===t.sendName?t.reciveName:t.sendName,i=0;if(a!==this.chatDetail.chatName?i++:setTimeout(function(){var e=s.$refs.bottomScroll;e.scrollTop=e.scrollHeight},100),this.localIndex>-1){this.messageList=this.localMessage[this.localIndex].list;var n=this.messageList.findIndex(function(e,s,t){return e.chatName===a});n>-1?(this.messageList[n].chatArr.push({name:t.sendName,mess:t.message}),i>0&&this.$set(this.messageList[n],"msNum",this.messageList[n].msNum+i)):this.messageList.push({chatName:a,chatArr:[{name:t.sendName,mess:t.message}],msNum:i}),this.localMessage[this.localIndex].list=this.messageList}else this.messageList.push({chatName:a,chatArr:[{name:t.sendName,mess:t.message}],msNum:i}),this.localMessage.push({name:this.chatLoginName,list:this.messageList}),this.localIndex=this.localMessage.length-1;localStorage.setItem("messageList",JSON.stringify(this.localMessage))}},close:function(){this.chatLoginName&&this.websock.send(JSON.stringify({type:"close",username:this.chatLoginName})),this.websocketclose()},websocketclose:function(){console.log("服务器关闭")},websocketonerror:function(){this.isChatLogin=!1,this.isErrMes=!0,this.errorMessage="websocket连接出错，请重新连接",console.log("连接出错")},send:function(e){return e&&this.isUseEnterSend&&e.preventDefault(),this.isChatLogin&&window.WebSocket?""===this.chatDetail.chatName?(this.layer.msg("请选择聊天对象"),!1):2!==this.chatDetail.type?(this.layer.msg("你们还不是好友，不能聊天哦"),!1):this.chatDetail.readay?""===this.message.replace(/\s/g,"")?(this.layer.msg("消息不能为空"),!1):void this.sendMes({type:"message",sendName:this.chatLoginName,reciveName:this.chatDetail.chatName,message:this.message}):(this.layer.msg("该好友不在线，不能聊天哦"),!1):(this.layer.msg("服务器关闭，请退出重新登录"),!1)},sendMes:function(e){var s={type:e.type,sendName:e.sendName,reciveName:e.reciveName,message:e.message};this.websock.send(JSON.stringify(s)),this.message=""},chatClick:function(e){var s=this,t=this.messageList.findIndex(function(s,t,a){return s.chatName===e.username});if(t>-1&&this.messageList[t].msNum>0){this.$set(this.messageList[t],"msNum",0);var a=this.localMessage.findIndex(function(e,t,a){return e.name===s.chatLoginName});this.localMessage[a].list=this.messageList,localStorage.setItem("messageList",JSON.stringify(this.localMessage))}setTimeout(function(){var e=s.$refs.bottomScroll;e.scrollTop=e.scrollHeight},100),this.chatDetail={chatName:e.username,type:e.type,readay:e.readay}},getReadyLine:function(e,s){var t=this.chatLineList.filter(function(s,t,a){return s.username===e.username}),a=0!==t.length&&t[0].readay;return this.chatList[s].readay=a,a},getFrendList:function(){var e=this;(0,i.chatFriendList)({name:this.chatLoginName}).then(function(s){0!==s.code?e.layer.msg((0,n.codeText)(s.code)):e.chatList=s.data})},getMessNum:function(e){var s=this.messageList.filter(function(s,t,a){return s.chatName===e.username});return 0===s.length?0:s[0].msNum},getChatAddFriend:function(e,s){var t=this;(0,i.chatAddFriend)({sendName:"add"===s?this.chatLoginName:e.username,reciveName:"recive"===s?this.chatLoginName:e.username,type:s}).then(function(a){0!==a.code?t.layer.msg((0,n.codeText)(a.code)):(t.getFrendList(),"recive"===s&&t.sendMes({type:"message",sendName:t.chatLoginName,reciveName:e.username,message:"我们已经是好友了，赶紧来聊天吧"}))})},loginout:function(){this.close(),this.$router.push({name:"chatLogin"})},changeChatTheme:function(e){var s=e.target.id;this.chatTheme=s||this.chatTheme},animalsAdd:function(){this.animals++}},created:function(){var e=this,s=this.$route.params.name||sessionStorage.getItem("chatLoginName"),t=sessionStorage.getItem("websocketLink");s&&"1"===t?(sessionStorage.setItem("chatLoginName",s),this.chatLoginName=s,this.getFrendList(),this.localIndex=this.localMessage.findIndex(function(s,t,a){return s.name===e.chatLoginName}),this.messageList=this.localIndex>-1?this.localMessage[this.localIndex].list:[],this.initWebSocket()):(sessionStorage.removeItem("chatLoginName"),this.$router.push({name:"chatLogin"}))}}},715:function(e,s,t){},716:function(e,s,t){},844:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a,i=t(10),n=(a=i)&&a.__esModule?a:{default:a};s.default=new n.default},845:function(e,s,t){"use strict";var a=t(715);t.n(a).a},846:function(e,s,t){"use strict";var a=t(716);t.n(a).a},890:function(e,s,t){"use strict";var a=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",{staticClass:"chat bg-color--hui",class:[e.chatTheme],staticStyle:{"min-height":"100%"}},[a("div",{staticClass:"chat-header tc",staticStyle:{height:"15%","line-height":"4.5",color:"#fff","font-size":"32px"}},[e._v("\n\t\t欢迎 "+e._s(e.chatLoginName)+" 进入渔火聊天室\n\t")]),e._v(" "),a("div",{staticClass:"chat-wrap all-wrap"},[a("div",{staticClass:"chat-frame bg-color--white"},[a("div",{staticClass:"fram-animals"},[a("img",{directives:[{name:"show",rawName:"v-show",value:e.animals%3==0,expression:"animals%3 === 0"}],staticClass:"animal-1",attrs:{src:t(777),alt:""}}),e._v(" "),a("img",{directives:[{name:"show",rawName:"v-show",value:e.animals%3==1,expression:"animals%3 === 1"}],staticClass:"animal-2",attrs:{src:t(778),alt:""}}),e._v(" "),a("img",{directives:[{name:"show",rawName:"v-show",value:e.animals%3==2,expression:"animals%3 === 2"}],staticClass:"animal-3",attrs:{src:t(779),alt:""}})]),e._v(" "),a("div",{staticClass:"fram-side f14"},[a("div",{staticClass:"fram-side-head tc pb20"},[a("p",{staticClass:"tl p10",staticStyle:{"margin-top":"0"}},[a("el-popover",{attrs:{placement:"top",trigger:"hover"}},[a("div",{staticClass:"chat-theme",on:{click:e.changeChatTheme}},[a("span",{attrs:{id:"chat-bg-color-0"}}),e._v(" "),a("span",{attrs:{id:"chat-bg-color-1"}}),e._v(" "),a("span",{attrs:{id:"chat-bg-color-2"}}),e._v(" "),a("span",{attrs:{id:"chat-bg-color-3"}}),e._v(" "),a("span",{attrs:{id:"chat-bg-color-4"}}),e._v(" "),a("span",{attrs:{id:"chat-bg-color-5"}}),e._v(" "),a("span",{attrs:{id:"chat-bg-color-6"}})]),e._v(" "),a("span",{staticClass:"cp",attrs:{slot:"reference"},slot:"reference"},[e._v("主题")])])],1),e._v(" "),a("img",{attrs:{src:e.GLOBAL.avatar,alt:""}}),e._v(" "),a("p",{staticClass:"mt10"},[e._v("\n\t\t\t\t\t\t"+e._s(e.chatLoginName)+" |\n\t\t\t\t\t\t"),a("span",{directives:[{name:"show",rawName:"v-show",value:!e.isChatLogin,expression:"!isChatLogin"}]},[e._v("离线")]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isChatLogin,expression:"isChatLogin"}]},[e._v("在线")])]),e._v(" "),a("p",{staticClass:"mt10 chat-btn-link"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isChatLogin,expression:"!isChatLogin"}],attrs:{type:"primary",size:"mini"},on:{click:e.initWebSocket}},[e._v("重新连接")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isChatLogin,expression:"isChatLogin"}],attrs:{type:"primary",size:"mini"},on:{click:e.loginout}},[e._v("切换账号")])],1)]),e._v(" "),a("div",{staticClass:"fram-side-search"},[a("el-input",{attrs:{size:"mini",placeholder:"请输入内容","suffix-icon":"el-icon-search"},model:{value:e.searchName,callback:function(s){e.searchName=s},expression:"searchName"}})],1),e._v(" "),a("el-row",{staticClass:"tc",staticStyle:{height:"40px","line-height":"40px"}},[a("el-col",{staticClass:"activePanel cp",class:["friend"===e.activePanel?"active":""],attrs:{span:12},nativeOn:{click:function(s){e.activePanel="friend"}}},[e._v("好友("+e._s(e.chatList.length)+")")]),e._v(" "),a("el-col",{staticClass:"activePanel cp",class:["groups"===e.activePanel?"active":""],attrs:{span:12},nativeOn:{click:function(s){e.activePanel="groups"}}},[e._v("群聊(0)")])],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"friend"===e.activePanel,expression:"activePanel === 'friend'"}],staticClass:"fram-side-list"},[a("div",{staticClass:"f-s-scroll scroll-style"},e._l(e.chatList,function(s,t){return a("div",{key:t,staticClass:"f-l-item",class:[s.username===e.chatDetail.chatName?"active":""],on:{click:function(t){e.chatClick(s)}}},[a("span",{staticClass:"f-l-name"},[e._v(e._s(s.username))]),e._v(" "),2===s.type?a("div",{staticStyle:{float:"right"}},[e.getMessNum(s)>0?a("span",{staticClass:"message-num chat-ms-num"},[e._v(e._s(e.getMessNum(s)))]):e._e()]):e._e(),e._v(" "),a("span",{staticClass:"f-l-isready"},[e._v(e._s(e.getReadyLine(s,t)?"在线":"离线"))]),e._v(" "),0===s.type?a("div",{staticStyle:{float:"right"}},[a("span",{staticClass:"btn btn-error chat-btn-reject"},[e._v("待通过")])]):e._e(),e._v(" "),1===s.type?a("div",{staticStyle:{float:"right"}},[a("span",{staticClass:"btn btn-success chat-btn-agree",on:{click:function(t){e.getChatAddFriend(s,"recive")}}},[e._v("接受")])]):e._e()])}),0)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"groups"===e.activePanel,expression:"activePanel === 'groups'"}],staticClass:"fram-side-list"},[a("div",{staticClass:"f-s-scroll scroll-style tc"},[e._v("\n\t\t\t\t\t\t敬请期待！\n\t\t\t\t\t")])])],1),e._v(" "),a("div",{staticClass:"fram-container"},[a("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.isErrMes,expression:"isErrMes"}],staticStyle:{position:"absolute",top:"-50px"},attrs:{title:e.errorMessage,type:"warning","show-icon":"",closable:!1}}),e._v(" "),a("div",{staticClass:"fram-head f14"},[a("div",[e._v(e._s(e.chatDetail.chatName))])]),e._v(" "),a("div",{staticClass:"fram-content"},[a("div",{ref:"bottomScroll",staticClass:"m-p-scroll scroll-style"},[a("div",{staticClass:"message-panel"},e._l(e.messageList,function(s){return s.chatName===e.chatDetail.chatName?a("div",e._l(s.chatArr,function(s){return a("div",{staticClass:"m-p-wrap"},[s.name===e.chatLoginName?a("el-row",{staticClass:"message-you",staticStyle:{"justify-content":"flex-end"},attrs:{type:"flex"}},[a("span",[e._v(e._s(s.mess))]),e._v(" "),a("img",{attrs:{src:e.GLOBAL.avatar,alt:""}})]):a("el-row",{staticClass:"message-he",attrs:{type:"flex"}},[a("img",{attrs:{src:e.GLOBAL.avatar,alt:""}}),e._v(" "),a("span",[e._v(e._s(s.mess))])])],1)}),0):e._e()}),0)])]),e._v(" "),a("div",{staticClass:"fram-input"},[a("div",{staticStyle:{padding:"0 2px"}},[a("el-input",{directives:[{name:"show",rawName:"v-show",value:!e.isUseEnterSend,expression:"!isUseEnterSend"}],attrs:{type:"textarea",placeholder:"请输入内容"},on:{focus:e.animalsAdd},model:{value:e.message,callback:function(s){e.message=s},expression:"message"}}),e._v(" "),a("el-input",{directives:[{name:"show",rawName:"v-show",value:e.isUseEnterSend,expression:"isUseEnterSend"}],attrs:{type:"textarea",placeholder:"请输入内容"},on:{focus:e.animalsAdd},nativeOn:{keydown:function(s){if(!("button"in s)&&e._k(s.keyCode,"enter",13,s.key,"Enter"))return null;e.send(s)}},model:{value:e.message,callback:function(s){e.message=s},expression:"message"}})],1)]),e._v(" "),a("div",{staticClass:"fram-foot"},[a("div",{staticClass:"tr chat-btn-link",staticStyle:{padding:"0 1px"}},[a("el-button",{on:{click:e.send}},[e._v("发送")])],1)])],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isShowSys,expression:"!isShowSys"}],staticClass:"fram-rgiht-open",on:{click:function(s){e.isShowSys=!e.isShowSys}}},[e._m(0)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowSys,expression:"isShowSys"}],staticClass:"fram-rgiht ml20 f14"},[a("div",{staticClass:"fram-head"},[a("div",[a("span",{staticClass:"cp",on:{click:function(s){e.isShowSys=!1}}},[a("i",{staticClass:"el-icon-arrow-left"})]),e._v(" 系统设置")])]),e._v(" "),a("div",{staticClass:"fram-right-content p10"},[a("h2",[e._v("系统消息")]),e._v(" "),a("div",{staticClass:"f-r-scroll scroll-style pl10"},e._l(e.sysMessages,function(s){return a("div",[e._v(e._s(s))])}),0),e._v(" "),a("h2",[e._v("设置快捷键")]),e._v(" "),a("div",{staticClass:"p10 chat-checkbox"},[a("el-checkbox",{model:{value:e.isUseEnterSend,callback:function(s){e.isUseEnterSend=s},expression:"isUseEnterSend"}},[e._v("使用enter发送")])],1)])])])])},i=[function(){var e=this.$createElement,s=this._self._c||e;return s("span",{staticClass:"f14 p10 cp",staticStyle:{display:"block",width:"14px"}},[this._v("系统设置"),s("i",{staticClass:"el-icon-arrow-down"})])}];a._withStripped=!0,t.d(s,"a",function(){return a}),t.d(s,"b",function(){return i})}}]);
//# sourceMappingURL=10.3c8b3512b2493cc4f30f.js.map