(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{630:function(s,e,t){"use strict";t.r(e);var a=t(813),i=t(702);for(var n in i)"default"!==n&&function(s){t.d(e,s,function(){return i[s]})}(n);t(779),t(780);var r=t(35),c=Object(r.a)(i.default,a.a,a.b,!1,null,"7311f14d",null);c.options.__file="src/pages/wechat/chat.vue",e.default=c.exports},702:function(s,e,t){"use strict";t.r(e);var a=t(703),i=t.n(a);for(var n in a)"default"!==n&&function(s){t.d(e,s,function(){return a[s]})}(n);e.default=i.a},703:function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a,i=t(637),n=t(639),r=t(223),c=(a=r)&&a.__esModule?a:{default:a};e.default={name:"chat",data:function(){return{chatLoginName:"",ws:"",searchName:"",chatDetail:{chatName:"",type:"",readay:""},chatLineList:[],chatList:[],message:"",localMessage:JSON.parse(sessionStorage.getItem("messageList"))||[],localIndex:"",messageList:[],errorMessage:"",isShowError:!1,sysMessages:[]}},methods:{send:function(){if(!window.WebSocket)return this.errorMessage="服务器关闭，请退出重新登录",void(this.isShowError=!0);if(""===this.chatDetail.chatName)return this.errorMessage="请选择聊天对象",void(this.isShowError=!0);if(""===this.message)return this.errorMessage="消息不能为空",void(this.isShowError=!0);if(2!==this.chatDetail.type)return this.errorMessage="你们还不是好友，不能聊天哦",void(this.isShowError=!0);if(!this.chatDetail.readay)return this.errorMessage="该好友不在线，不能聊天哦",void(this.isShowError=!0);var s={type:"message",sendName:this.chatLoginName,reciveName:this.chatDetail.chatName,message:this.message};this.ws.send(JSON.stringify(s)),this.message=""},chatClick:function(s){var e=this,t=this.messageList.findIndex(function(e,t,a){return e.chatName===s.username});if(t>-1&&this.messageList[t].msNum>0){this.$set(this.messageList[t],"msNum",0);var a=this.localMessage.findIndex(function(s,t,a){return s.name===e.chatLoginName});this.localMessage[a].list=this.messageList,sessionStorage.setItem("messageList",JSON.stringify(this.localMessage))}setTimeout(function(){var s=e.$refs.bottomScroll;s.scrollTop=s.scrollHeight},100),this.chatDetail={chatName:s.username,type:s.type,readay:s.readay},this.errorMessage="",this.isShowError=!1},getReadyLine:function(s,e){var t=this.chatLineList.filter(function(e,t,a){return e.username===s.username}),a=0!==t.length&&t[0].readay;return this.chatList[e].readay=a,a},getFrendList:function(){var s=this;(0,i.chatFriendList)({name:this.chatLoginName}).then(function(e){0!==e.code?s.layer.msg((0,n.codeText)(e.code)):s.chatList=e.data})},getMessNum:function(s){var e=this.messageList.filter(function(e,t,a){return e.chatName===s.username});return 0===e.length?0:e[0].msNum},getChatAddFriend:function(s,e){var t=this;(0,i.chatAddFriend)({sendName:"add"===e?this.chatLoginName:s.username,reciveName:"recive"===e?this.chatLoginName:s.username,type:e}).then(function(s){0!==s.code?t.layer.msg((0,n.codeText)(s.code)):t.getFrendList()})},wsClose:function(){this.ws.send(JSON.stringify({type:"close",username:this.chatLoginName})),this.ws.onclose()},loginout:function(){this.wsClose(),this.$router.push({name:"chatLogin"})}},mounted:function(){var s=this;c.default.$on("system",function(e){s.sysMessages.push(e.message)}),c.default.$on("userList",function(e){s.chatLineList=e.message}),c.default.$on("message",function(e){var t=s.chatLoginName===e.sendName?e.reciveName:e.sendName,a=0;if(t!==s.chatDetail.chatName?a++:setTimeout(function(){var e=s.$refs.bottomScroll;e.scrollTop=e.scrollHeight},100),s.localIndex>-1){s.messageList=s.localMessage[s.localIndex].list;var i=s.messageList.findIndex(function(s,e,a){return s.chatName===t});i>-1?(s.messageList[i].chatArr.push({name:e.sendName,mess:e.message}),a>0&&s.$set(s.messageList[i],"msNum",s.messageList[i].msNum+a)):s.messageList.push({chatName:t,chatArr:[{name:e.sendName,mess:e.message}],msNum:a}),s.localMessage[s.localIndex].list=s.messageList}else s.messageList.push({chatName:t,chatArr:[{name:e.sendName,mess:e.message}],msNum:a}),s.localMessage.push({name:s.chatLoginName,list:s.messageList}),s.localIndex=s.localMessage.length-1;sessionStorage.setItem("messageList",JSON.stringify(s.localMessage))})},created:function(){var s=this,e=this.$route.params.name||sessionStorage.getItem("chatLoginName"),t=sessionStorage.getItem("websocketLink");e&&"1"===t?(sessionStorage.setItem("chatLoginName",e),this.chatLoginName=e,this.getFrendList(),this.localIndex=this.localMessage.findIndex(function(e,t,a){return e.name===s.chatLoginName}),this.messageList=this.localIndex>-1?this.localMessage[this.localIndex].list:[]):(sessionStorage.removeItem("chatLoginName"),this.$router.push({name:"chatLogin"}))}}},704:function(s,e,t){},705:function(s,e,t){},779:function(s,e,t){"use strict";var a=t(704);t.n(a).a},780:function(s,e,t){"use strict";var a=t(705);t.n(a).a},813:function(s,e,t){"use strict";var a=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"chat"},[t("v-head-back-2",{attrs:{url:"/"}}),s._v(" "),t("div",{staticClass:"chat-wrap"},[t("div",{staticClass:"chat-frame"},[t("div",{staticClass:"fram-side"},[t("div",{staticClass:"fram-side-head"},[t("span",[s._v(s._s(s.chatLoginName))]),s._v(" "),t("span",{staticClass:"cursor-point",on:{click:s.loginout}},[s._v("退出")])]),s._v(" "),t("div",{staticStyle:{height:"40px","line-height":"40px","padding-left":"5px"}},[s._v("\n\t\t\t\t\t好友列表("+s._s(s.chatList.length)+")\n\t\t\t\t")]),s._v(" "),t("div",{staticClass:"fram-side-search"},[t("el-input",{attrs:{size:"mini",placeholder:"请输入内容","suffix-icon":"el-icon-search"},model:{value:s.searchName,callback:function(e){s.searchName=e},expression:"searchName"}})],1),s._v(" "),t("div",{staticClass:"fram-side-list"},[t("div",{staticClass:"f-s-scroll scroll-style"},s._l(s.chatList,function(e,a){return t("div",{key:a,staticClass:"f-l-item",class:[e.username===s.chatDetail.chatName?"active":""],on:{click:function(t){s.chatClick(e)}}},[t("span",{staticClass:"f-l-name"},[s._v(s._s(e.username))]),s._v(" "),2===e.type?t("div",{staticStyle:{float:"right"}},[s.getMessNum(e)>0?t("span",{staticClass:"message-num chat-ms-num"},[s._v(s._s(s.getMessNum(e)))]):s._e()]):s._e(),s._v(" "),t("span",{staticClass:"f-l-isready"},[s._v(s._s(s.getReadyLine(e,a)?"在线":"离线"))]),s._v(" "),0===e.type?t("div",{staticStyle:{float:"right"}},[t("span",{staticClass:"btn btn-error chat-btn-reject"},[s._v("待通过")])]):s._e(),s._v(" "),1===e.type?t("div",{staticStyle:{float:"right"}},[t("span",{staticClass:"btn btn-success chat-btn-agree",on:{click:function(t){s.getChatAddFriend(e,"recive")}}},[s._v("接受")])]):s._e()])}),0)])]),s._v(" "),t("div",{staticClass:"fram-container"},[s.isShowError?t("div",{staticClass:"errorMssage"},[t("div",[t("el-alert",{attrs:{title:s.errorMessage,type:"warning","show-icon":"",closable:!1}})],1)]):s._e(),s._v(" "),t("div",{staticClass:"fram-head"},[t("div",[s._v(s._s(s.chatDetail.chatName))])]),s._v(" "),t("div",{staticClass:"fram-content"},[t("div",{ref:"bottomScroll",staticClass:"m-p-scroll scroll-style"},[t("div",{staticClass:"message-panel"},s._l(s.messageList,function(e){return e.chatName===s.chatDetail.chatName?t("div",s._l(e.chatArr,function(e){return t("div",{staticClass:"m-p-wrap"},[e.name===s.chatLoginName?t("div",{staticClass:"t-right"},[t("div",{staticClass:"m-p-name-1"},[s._v(s._s(e.name))]),s._v(" "),t("span",{staticClass:"m-p-text-1 right"},[s._v(s._s(e.mess))])]):t("div",{staticClass:"t-left"},[t("div",{staticClass:"m-p-name-2"},[s._v(s._s(e.name))]),s._v(" "),t("span",{staticClass:"m-p-text-2"},[s._v(s._s(e.mess))])])])}),0):s._e()}),0)])]),s._v(" "),t("div",{staticClass:"fram-input"},[t("div",{staticStyle:{padding:"0 2px"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},nativeOn:{keyup:function(e){return"button"in e||!s._k(e.keyCode,"enter",13,e.key,"Enter")?s.send(e):null}},model:{value:s.message,callback:function(e){s.message=e},expression:"message"}})],1)]),s._v(" "),t("div",{staticClass:"fram-foot t-right"},[t("div",{staticStyle:{padding:"0 1px"}},[t("el-button",{on:{click:s.send}},[s._v("发送")])],1)])]),s._v(" "),t("div",{staticClass:"fram-rgiht"},[s._m(0),s._v(" "),t("div",{staticClass:"fram-right-content"},[t("div",{staticClass:"f-r-scroll scroll-style"},s._l(s.sysMessages,function(e){return t("div",[s._v(s._s(e))])}),0)])])])])],1)},i=[function(){var s=this.$createElement,e=this._self._c||s;return e("div",{staticClass:"fram-head"},[e("div",[this._v("系统消息")])])}];a._withStripped=!0,t.d(e,"a",function(){return a}),t.d(e,"b",function(){return i})}}]);
//# sourceMappingURL=10.7be7bc2dea3add384f99.js.map